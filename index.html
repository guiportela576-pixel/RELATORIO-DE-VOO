<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>üìù Relat√≥rio de Voo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css?v=32" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
</head>

<body>
  <main class="app-main">
    <header class="app-header">
      <div class="header-top">
        <h1>üìù Relat√≥rio de Voo</h1>
        <div class="subhead">Preencha o relat√≥rio do jeito da folha (DADOS DO VOO)</div>
      </div>

      <div class="tabs" role="tablist" aria-label="Navega√ß√£o">
        <button id="tabBtnNew" class="active" type="button" onclick="showTab('new')">
          <span class="tab-label">Novo</span>
        </button>
        <button id="tabBtnHistory" type="button" onclick="showTab('history')">
          <span class="tab-label">Hist√≥rico</span>
        </button>
        <button id="tabBtnUAs" type="button" onclick="showTab('uas')">
          <span class="tab-label">Registro</span>
        </button>
      </div>
    </header>

    <!-- ======= TAB: NOVO ======= -->
    <section id="tab-new" class="tab-content">
      <section class="card">
        <h2>Dados do voo</h2>

        <div class="row" style="margin: 8px 0 10px 0;">
          <button id="btnStart" class="btn-green" type="button" onclick="startFlight()">Iniciar voo</button>
          <button id="btnEnd" class="btn-red" type="button" onclick="endFlight()">Encerrar voo</button>
        </div>

        <div id="runMsg" class="op-msg" style="display:none;"></div>

        <div class="grid">
  <div class="field span-2">
    <label for="f_date">Data</label>
    <input type="date" id="f_date" class="span-2" />
  </div>

  <div class="field">
    <label for="f_inicio">In√≠cio (auto)</label>
    <input type="time" id="f_inicio" readonly />
  </div>

  <div class="field">
    <label for="f_tempo">Tempo de voo (min) (auto)</label>
    <input type="number" id="f_tempo" min="1" readonly />
  </div>

  <div class="field">
    <label for="f_num">N¬∫ (autom√°tico)</label>
    <input type="number" id="f_num" min="1" readonly />
  </div>

  <div class="field">
    <label for="f_missao">Miss√£o (opcional)</label>
    <input type="number" id="f_missao" inputmode="numeric" pattern="[0-9]*" min="1" placeholder="Ex: 1" />
  </div>

    <div class="field span-2">
    <label for="f_codigo">C√≥digo da opera√ß√£o (opcional)</label>
    <input type="text" id="f_codigo" readonly placeholder="Toque para selecionar" onclick="openCodePicker()" />
  </div>

  <div class="field span-2">
    <label for="f_voo">Voo (opcional)</label>
    <input type="text" id="f_voo" inputmode="decimal" pattern="[0-9.,]*" placeholder="Ex: 1.1" lang="en-US" />
  </div>

  <div class="field span-2">
    <label for="f_nome">Nome</label>
    <select id="f_nome"></select>
  </div>

  <div class="field span-2">
    <label for="f_ua">UA (opcional)</label>
    <select id="f_ua"></select>
  </div>

  <div class="field">
    <label for="f_ciclos">Ciclos (opcional)</label>
    <input type="number" id="f_ciclos" inputmode="numeric" pattern="[0-9]*" min="0" max="400" />
  </div>

  <div class="field">
    <label for="f_nbat">N¬∫ Bat (opcional)</label>
    <input type="number" id="f_nbat" inputmode="numeric" pattern="[0-9]*" min="1" max="6" />
  </div>

    <div class="field">
    <label for="f_carga_ini">Carga inicial (%)</label>
    <input type="number" id="f_carga_ini" inputmode="numeric" pattern="[0-9]*" min="0" max="100" />
  </div>

    <div class="field">
    <label for="f_carga_fim">Carga final (%)</label>
    <input type="number" id="f_carga_fim" inputmode="numeric" pattern="[0-9]*" min="0" max="100" />
  </div>

  <div class="field span-2">
    <label for="f_obs">Observa√ß√£o (opcional)</label>
    <textarea id="f_obs" class="span-2"></textarea>
  </div>
</div></div>

        <div class="row" style="margin-top:10px;">
          <button class="primary" type="button" onclick="saveEntry()">Salvar</button>
          <button class="ghost" type="button" onclick="clearForm()">Limpar</button>
        </div>
      </section>
    </section>

    <!-- ======= TAB: HIST√ìRICO ======= -->
    <section id="tab-history" class="tab-content" style="display:none;">
      <section class="card">

        <div class="row" style="margin-top:8px;">
          <button type="button" class="ghost" onclick="syncPull()">Atualizar da planilha</button>
          <button type="button" onclick="syncPush()">Enviar para planilha</button>
        </div>
        <div id="syncStatus" class="hint" style="margin-top:6px;"></div>

        <div class="row space" style="margin-top:10px;">
          <h2>Hist√≥rico</h2>
          <button class="ghost" type="button" onclick="exportTextAll()">Copiar tudo</button>
          <button class="ghost" type="button" onclick="exportPdfDay()">Exportar PDF (dia)</button>
        </div>

<div class="grid" style="margin-top:10px;">
          <input type="date" id="filterDate" />
          <select id="filterUA"></select>
        </div>

        <div class="row" style="margin-top:8px;">
          <button type="button" onclick="applyFilters()">Aplicar</button>
          <button type="button" class="ghost" onclick="clearFilters()">Limpar</button>
        </div>

        <div id="dayTotal" class="hint" style="margin-top:10px; display:none;"></div>

        <ul id="historyList" class="list" style="margin-top:10px;"></ul>
        <div id="emptyHistory" class="hint" style="display:none; margin-top:10px;">Nenhum registro ainda.</div>
      </section>
    </section>

    <!-- ======= TAB: UA ======= -->
    <section id="tab-uas" class="tab-content" style="display:none;">
      <section class="card">
        <h2>Registro</h2>
        <p class="hint">Cadastre aqui suas UAs para n√£o precisar digitar toda vez.</p>

        


        
        <h3 style="margin-top:12px;">Nome</h3>
        <p class="hint">Defina aqui o nome de quem est√° usando este celular. Esse nome sai autom√°tico nos registros.</p>
        <div class="grid">
          <input type="text" id="nameNew" class="span-2" placeholder="Ex: Guilherme" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button type="button" onclick="addName()">Adicionar</button>
          <button type="button" class="ghost" onclick="setDefaultName()">Definir como padr√£o</button>
        </div>

        <h3 style="margin-top:12px;">Lista de nomes</h3>
        <ul id="nameList" class="list"></ul>

        <div class="divider"></div>

<div class="grid">
          <input type="text" id="uaNew" class="span-2" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button type="button" onclick="addUA()">Adicionar</button>
          <button type="button" class="ghost" onclick="setDefaultUA()">Definir como padr√£o</button>
        </div>

        <h3 style="margin-top:12px;">Lista</h3>
        <ul id="uaList" class="list"></ul>

                <h3 style="margin-top:12px;">Cadastro de C√≥digo</h3>
        <p class="hint">Cadastre aqui os c√≥digos da opera√ß√£o para aparecerem no campo "C√≥digo da opera√ß√£o" na aba Novo.</p>
        <div class="grid">
          <input type="text" id="codeNew" class="span-2" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button type="button" onclick="addCode()">Adicionar c√≥digo</button>
          <button type="button" class="ghost" id="btnToggleCodes" onclick="toggleCodes()">Recolher c√≥digos</button>
        </div>
        <ul id="codeList" class="list" style="margin-top:10px;"></ul>

        <div class="divider"></div>

        <h3>Vers√£o</h3>
        <div class="version-box">
          <div><strong>Vers√£o do app:</strong> <span id="appVersion">‚Äî</span></div>
          <div style="margin-top:6px;"><strong>Hist√≥rico:</strong></div>
          <ul id="versionHistory" class="list compact"></ul>
        </div>
      </section>
    </section>

    <!-- ======= MODAL: EDITAR ======= -->
    <div id="modalOverlay" class="modal-overlay" style="display:none;">
      <div class="modal-card">
        <div class="modal-header">
          <h2>Editar registro</h2>
          <button type="button" class="icon-btn" onclick="closeModal()">‚úñ</button>
        </div>

        <div class="modal-sub" id="modalSub">‚Äî</div>

        <div class="grid" style="margin-top:10px;">
          <input type="number" id="e_num" min="1" />
          <input type="number" id="e_missao" inputmode="numeric" pattern="[0-9]*" min="1" placeholder="Ex: 1" />

          <select id="e_nome"></select>


          <select id="e_codigo"></select>

          <input type="text" id="e_voo" inputmode="decimal" pattern="[0-9.,]*" placeholder="Ex: 1.1" lang="en-US" />
          <input type="time" id="e_inicio" />

          <input type="number" id="e_tempo" min="1" />
          <select id="e_ua"></select>

          <input type="number" id="e_ciclos" inputmode="numeric" pattern="[0-9]*" min="0" max="400" />
          <input type="number" id="e_nbat" inputmode="numeric" pattern="[0-9]*" min="1" max="6" />

          <select id="e_carga_ini"></select>
          <select id="e_carga_fim" class="span-2"></select>

          <textarea id="e_obs" class="span-2"></textarea>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="primary" type="button" onclick="saveEdit()">Salvar</button>
          <button class="ghost" type="button" onclick="deleteEdit()">Excluir</button>
        </div>
      </div>
    </div>

    <!-- ======= MODAL: PDF PREVIEW ======= -->
    <div id="pdfOverlay" class="modal-overlay" style="display:none;">
      <div class="modal-card pdf-card">
        <div class="modal-header">
          <div>
            <div class="modal-title" id="pdfTitle">Pr√©via do PDF</div>
            <div class="modal-sub">Use "Imprimir/Salvar" e depois feche para voltar ao app.</div>
          </div>
          <button class="modal-close" type="button" onclick="closePdfPreview()">‚úï</button>
        </div>

        <div class="pdf-frame-wrap">
          <iframe id="pdfFrame" title="Pr√©via do relat√≥rio"></iframe>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="primary" type="button" onclick="printPdfPreview()">Imprimir / Salvar PDF</button>
          <button class="ghost" type="button" onclick="closePdfPreview()">Fechar</button>
        </div>
      </div>
    </div>

    <footer class="tabs-footer" aria-hidden="true"></footer>
  </main>

  <script src="app.js?v=32"></script>

  <!-- ===== Code Picker (Tela cheia) ===== -->
  <div id="codePickerModal" class="modal-overlay" style="display:none;" onclick="codePickerBackdrop(event)">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Selecionar c√≥digo da opera√ß√£o" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>Selecionar c√≥digo</h2>
        <button type="button" class="icon-btn" onclick="closeCodePicker()">Fechar</button>
      </div>
      <div class="modal-sub">Toque em um c√≥digo para preencher no formul√°rio.</div>
      <ul id="codePickerList" class="list" style="margin-top:10px;"></ul>
    </div>
  </div>

</body>
</html>
